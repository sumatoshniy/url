{% extends "base.html" %}

{% block title %}Загрузка PDF{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Добавление PDF файла</h2>
        <div>
            <a href="{{ url_for('manage_pdf') }}" class="btn btn-info btn-sm">
                Управление PDF
            </a>
            <a href="{{ url_for('contracts') }}" class="btn btn-secondary btn-sm">
                Назад к договорам
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Добавить новый PDF</h5>
        </div>
        <div class="card-body">
            <form method="POST">
                <div class="mb-3">
                    <label for="contract_num" class="form-label">Номер договора *</label>
                    <input type="text" class="form-control" id="contract_num"
                           name="contract_num" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Тип источника *</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="storage_type"
                               id="storage_url" value="url" checked>
                        <label class="form-check-label" for="storage_url">
                            URL (внешняя ссылка)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="storage_type"
                               id="storage_dir" value="dir">
                        <label class="form-check-label" for="storage_dir">
                            Локальный путь
                        </label>
                    </div>
                </div>

                <!-- Блок для URL -->
                <div id="url_section">
                    <div class="mb-3">
                        <label for="pdf_url" class="form-label">URL *</label>
                        <input type="url" class="form-control" id="pdf_url"
                               name="pdf_url" placeholder="https://example.com/document.pdf">
                        <div class="form-text">Введите полный URL к PDF файлу</div>
                    </div>
                    <div class="mb-3">
                        <label for="file_name_url" class="form-label">Имя файла (опционально)</label>
                        <input type="text" class="form-control" id="file_name_url"
                               name="file_name" placeholder="document.pdf">
                        <div class="form-text">Имя файла для отображения пользователям</div>
                    </div>
                </div>

                <!-- Блок для локального пути -->
                <div id="dir_section" style="display: none;">
                    <div class="mb-3">
                        <label for="pdf_dir" class="form-label">Путь к файлу или директории *</label>
                        <input type="text" class="form-control" id="pdf_dir"
                               name="pdf_dir" placeholder="/путь/к/файлу.pdf или /путь/к/директории/">
                        <div class="form-text">
                            Укажите полный путь к PDF файлу или к директории, содержащей PDF файлы<br>
                            <strong>Примеры:</strong><br>
                            - Полный путь к файлу: /var/www/pdf/dogovor_123.pdf<br>
                            - Директория с файлами: /var/www/pdf/contracts/
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="file_name_dir" class="form-label">Имя файла (опционально)</label>
                        <input type="text" class="form-control" id="file_name_dir"
                               name="file_name" placeholder="document.pdf">
                        <div class="form-text">
                            Требуется только если указана директория (для выбора конкретного файла)
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                    <a href="{{ url_for('contracts') }}" class="btn btn-secondary">Отмена</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlSection = document.getElementById('url_section');
    const dirSection = document.getElementById('dir_section');
    const storageRadios = document.querySelectorAll('input[name="storage_type"]');
    const pdfUrl = document.getElementById('pdf_url');
    const pdfDir = document.getElementById('pdf_dir');

    function updateSections() {
        const selectedValue = document.querySelector('input[name="storage_type"]:checked').value;

        urlSection.style.display = selectedValue === 'url' ? 'block' : 'none';
        dirSection.style.display = selectedValue === 'dir' ? 'block' : 'none';

        // Делаем поля обязательными
        pdfUrl.required = (selectedValue === 'url');
        pdfDir.required = (selectedValue === 'dir');
    }

    storageRadios.forEach(radio => {
        radio.addEventListener('change', updateSections);
    });

    updateSections(); // Инициализация
});
</script>
{% endblock %}